---
title: Message Structure
tags:
- EGR314
- Message Structure
---

# Message Types

As described in the Project Description, messages sent between individual boards must follow the standardized 64-byte packet structure below:

---
config:
  packet:
    bitsPerRow: 16
    bitWidth: 64
---
packet-beta
title Message
0: "0x41"
1: "0x5a"
2: "Source ID"
3: "Dest ID"
4-61: "Message (Variable Length <= 58 Bytes)"
62: "0x59"
63: "0x42"

What goes in the message payload (bytes 4–61) is defined by the team and is documented below.

---

## Message Type Overview

| Message Type (uint16_t) | Short Description |
|-------------------------:|------------------|
| 0x0001 | Set Motor Speed |
| 0x0002 | Request Sensor Data |
| 0x0003 | Sensor Data Response |
| 0x0004 | Motor Telemetry Response |
| 0x0005 | Emergency Stop |
| 0x0006 | Error Code |
| 0x0007 | Error Message (string) |
| 0x0008 | System Status Code |
| 0x0043 | Button Pushed (HMI) |

---

## Message Type 0x0001 — Set Motor Speed

Used when Web or HMI sets desired motor speed.

Absolute byte positions in full 64-byte frame:

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 0 | 0x41 (Header) | byte |
| 1 | 0x5A (Header) | byte |
| 2 | Source ID | uint8_t |
| 3 | Dest ID | uint8_t |
| 4–5 | Message Type = 0x0001 | uint16_t |
| 6 | Motor ID | uint8_t |
| 7–8 | Speed (RPM) | uint16_t |
| 9–61 | Reserved / zero-fill | bytes |
| 62 | 0x59 (Footer) | byte |
| 63 | 0x42 (Footer) | byte |

---

## Message Type 0x0002 — Request Sensor Data

ESP32 requests updated sensor data from Sensor + HMI board.

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0002 | uint16_t |
| 6 | Sensor ID | uint8_t |
| 7–61 | Reserved / zero-fill | bytes |

---

## Message Type 0x0003 — Sensor Data Response

Sensor + HMI → ESP32 containing multiple readings.

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0003 | uint16_t |
| 6–7 | IMU Tilt (degrees ×100) | int16_t |
| 8–9 | Temperature (°C ×100) | uint16_t |
| 10–11 | Hazard Score (0–100 ×100 optional) | uint16_t |
| 12–13 | Humidity (% ×100) *(optional/expandable)* | uint16_t |
| 14–61 | Reserved / additional sensor fields | bytes |

---

## Message Type 0x0004 — Motor Telemetry Response

Actuator board → upstream reporting motor state.

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0004 | uint16_t |
| 6 | Motor State (0=Stop,1=Fwd,2=Rev) | uint8_t |
| 7–8 | Current Speed (RPM) | uint16_t |
| 9–61 | Reserved / telemetry expansion | bytes |

---

## Message Type 0x0005 — Emergency Stop

Issued by HMI or ESP32 (web) or generated by fail-safe logic.

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0005 | uint16_t |
| 6 | Stop Source (1=Web,2=HMI,3=FailSafe) | uint8_t |
| 7–61 | Reserved | bytes |

---

## Message Type 0x0006 — Error Code

Compact fault reporting (numeric).

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0006 | uint16_t |
| 6 | Subsystem ID | uint8_t |
| 7 | Error Code (numeric) | uint8_t |
| 8–61 | Reserved | bytes |

---

## Message Type 0x0007 — Error Message (Human-readable)

Human-readable ASCII message (null-terminated). Max 55 characters usable.

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0007 | uint16_t |
| 6–60 | Error String (max 55 chars) | char[<=55] |
| 61 | Null terminator (0x00) — ensure present if string shorter | byte |

> Note: Strings must include a terminating 0x00. Maximum usable characters = 55.

---

## Message Type 0x0008 — System Status Code

Periodic health/status code.

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0008 | uint16_t |
| 6 | Status Code | uint8_t |
| 7–61 | Reserved | bytes |

---

## Message Type 0x0043 — Button Pushed (HMI)

Local HMI button events forwarded upstream.

| Byte (absolute) | Field | Data Type |
|----------------:|-------|-----------|
| 4–5 | Message Type = 0x0043 | uint16_t |
| 6 | Button Number | uint8_t |
| 7–61 | Reserved | bytes |

---

## Example Frame (absolute bytes)

ESP32 (Source ID = 0x01) requests sensor data from Sensor board (Dest ID = 0x02):

- Byte 0:  0x41  
- Byte 1:  0x5A  
- Byte 2:  0x01  (Source ID = ESP32)  
- Byte 3:  0x02  (Dest ID = Sensor board)  
- Byte 4:  0x00  (Message Type high byte)  
- Byte 5:  0x02  (Message Type low byte → 0x0002 Request Sensor Data)  
- Byte 6:  0x01  (Sensor ID)  
- Byte 7–61: zero-filled/reserved  
- Byte 62: 0x59  
- Byte 63: 0x42

---
